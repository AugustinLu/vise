
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Tutorial pydefect &#8212; vise beta documentation</title>
    <link rel="stylesheet" href="_static/corlab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="# Change log" href="change_log.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="change_log.html" title="# Change log"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">vise beta documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-pydefect">
<h1>Tutorial  pydefect<a class="headerlink" href="#tutorial-pydefect" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="preparation-of-the-unit-cell">
<h2>1. Preparation of the unit cell<a class="headerlink" href="#preparation-of-the-unit-cell" title="Permalink to this headline">¶</a></h2>
<p>Here, we show how to use vise using an example of ScN.</p>
<p>Please create ScN directory and unitcell subdirectory in it, and enter there.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ScN
 │
 ├ vise.yaml
 │
 ├ unitcell/ ── structure_opt/
 │            ├ band/
 │            └ dos/
 │            
 └ optical_absorption
             ...
</pre></div>
</div>
<p>Firstly, we obtain the POSCAR file via Materials Project REST API.
(Of course, it’s also fine to prepare POSCAR by another way by yourself instead.)
When we use the Materials Project REST API,
we need to set the PMG_MAPI_KEY in the .pmgrc.yaml file at the home directory, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PMG_MAPI_KEY</span><span class="p">:</span> <span class="n">xxxxxxxxxxxxxxxx</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://pymatgen.org/usage.html">pymatgen web page 1</a> or <a class="reference external" href="https://pymatgen.org/_modules/pymatgen/io/vasp/inputs.html">2</a>, for more details.</p>
<p>When we ckeck the Materials Project web page, we can know the id for ScN is mp-2857.
Therefore, by typing as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py gp -n 2857 
</pre></div>
</div>
<p>we can get the crystal structure of ScN.</p>
</div>
<div class="section" id="preparation-of-the-input-files-for-the-unit-cell-relaxation">
<h2>2. Preparation of the input files for the unit cell relaxation.<a class="headerlink" href="#preparation-of-the-input-files-for-the-unit-cell-relaxation" title="Permalink to this headline">¶</a></h2>
<p>We next relax the unit cell using VASP.
Please create <code class="docutils literal notranslate"><span class="pre">structure_opt</span></code></p>
<p>For this purpose, we need to prepare INCAR, POTCAR, KPOINTS files.
In vise, <code class="docutils literal notranslate"><span class="pre">vs</span></code>(=<code class="docutils literal notranslate"><span class="pre">vasp_set</span></code>) automatically generate these files.
The default task and exchange-correlation (XC) functional of <code class="docutils literal notranslate"><span class="pre">vs</span></code> are structure optimization (structure_opt) and PBEsol functional (pbesol).
So, by typing as follows, at the directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py vs
</pre></div>
</div>
<p>In options, there are -uis(=user_incar_setting) and -auis(=additional_user_incar_setting).
The former is set by vise.yaml by default, and if one uses this option, the vise.yaml default setting is overwritten.
Conversely, the latter is set only via this option.
Please use both the options as the situation demands.</p>
</div>
<div class="section" id="calculation-of-the-unit-cell-relaxation">
<h2>3. Calculation of the unit cell relaxation.<a class="headerlink" href="#calculation-of-the-unit-cell-relaxation" title="Permalink to this headline">¶</a></h2>
<p>We then run the vasp.
For this purpose, vise provides an extension utility of <code class="docutils literal notranslate"><span class="pre">custodian</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">vr</span></code>(=<code class="docutils literal notranslate"><span class="pre">vasp_run</span></code>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py vr -v &quot;mpirun -np xx vasp_std&quot;
</pre></div>
</div>
<p>We provide four error handler groups, i.e., “minimum”, “default”, “dielectric”, and “no_handler”.
If you do not want to use custodian error handler, please set “no_handler” to -handler_name option.
See also vise.custodian_extension.handler_groups.py for details.</p>
<p>In most cases, we run VASP with cluster nodes via submitting runshell script.
An example of runshell script is shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/zsh</span>
<span class="c1">#$ -S /bin/zsh</span>
<span class="c1">#$ -cwd</span>
<span class="c1">#$ -V</span>
<span class="c1">#$ -j y</span>
<span class="c1">#$ -N pydefect</span>
<span class="c1">#$ -o std.log</span>
<span class="c1">#$ -pe all_pe* 36</span>
<span class="c1">#============ Shell Script ============</span>

<span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">vise</span><span class="o">/</span><span class="n">vise</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vr</span>
</pre></div>
</div>
<p>In order to perform the k-point convergence, please use <code class="docutils literal notranslate"><span class="pre">-kc</span></code> options.
In such cases, we can set various options such as -criteria.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py vr --print
</pre></div>
</div>
</div>
<div class="section" id="calculation-of-the-band-structure-and-the-density-of-states">
<h2>4. Calculation of the band structure and the density of states<a class="headerlink" href="#calculation-of-the-band-structure-and-the-density-of-states" title="Permalink to this headline">¶</a></h2>
<p>We then run the Calculation of the band structure and density of states.
Please create band and dos directories at the unitcell, and type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py vs -t band
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py vs -t dos
</pre></div>
</div>
<p>in each directory and run the vasp calculations as above.</p>
<p>Here, the band path is determined based upon the <a class="reference external" href="https://www.materialscloud.org/work/tools/seekpath">seekpath code</a>,
so if one uses the plot for publication or presentation, please cite the following paper.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0927025616305110?via%3Dihub">Y. Hinuma, G. Pizzi, Y. Kumagai, F. Oba, I. Tanaka, Band structure diagram paths based on crystallography, Comp. Mat. Sci. 128, 140 (2017).</a>
DOI: 10.1016/j.commatsci.2016.10.015 (the “HPKOT” paper; arXiv version: arXiv:1602.06402).</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">VISE</span></code> also provides the plotters of BS and DOS based on with <code class="docutils literal notranslate"><span class="pre">plot_band</span></code> (=<code class="docutils literal notranslate"><span class="pre">pb</span></code>) and <code class="docutils literal notranslate"><span class="pre">plot_dos</span></code> (=<code class="docutils literal notranslate"><span class="pre">pd</span></code>) sub-commands.
Type the following commands in <code class="docutils literal notranslate"><span class="pre">band/</span></code> and  <code class="docutils literal notranslate"><span class="pre">dos/</span></code>, respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py pb -f band.pdf
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py pb -f dos.pdf
</pre></div>
</div>
<p>The band gap is also evaluated using <code class="docutils literal notranslate"><span class="pre">bg</span></code>(=<code class="docutils literal notranslate"><span class="pre">band_gap</span></code>) sub command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_VISE/vise/vise/main.py bg -v vasprun.xml.finish -o OUTCAR.finish
</pre></div>
</div>
</div>
<div class="section" id="calculation-of-the-dielectric-constant">
<h2>5. Calculation of the dielectric constant<a class="headerlink" href="#calculation-of-the-dielectric-constant" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="setting-for-the-vise-yaml">
<h2>Setting for the vise.yaml<a class="headerlink" href="#setting-for-the-vise-yaml" title="Permalink to this headline">¶</a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">VISE</span></code>, users can control various types of parameters using <code class="docutils literal notranslate"><span class="pre">vise.yaml</span></code> files.
For example, we provide the default <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code> set regularly we use, but users can adopt their favorite <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code> set,
by setting <code class="docutils literal notranslate"><span class="pre">potcar_set</span></code> key as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">potcar_set</span><span class="p">:</span> <span class="n">Mg_pv</span> <span class="n">O_h</span>
</pre></div>
</div>
<p>Then, the Mg_pv and O_h <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code> files are used instead of the normal Mg and O <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code> files.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">VISE</span></code> try to find the <code class="docutils literal notranslate"><span class="pre">vise.yaml</span></code> file from the current working directory to the parent directly up to the home or root directory.
Therefore, when <code class="docutils literal notranslate"><span class="pre">vise.yaml</span></code> is located at the top directory of the project as shown above directory tree,
the parameters are always used for the <code class="docutils literal notranslate"><span class="pre">pydefect</span></code> commands.
The keys for <code class="docutils literal notranslate"><span class="pre">vise.yaml</span></code> are</p>
<ul class="simple">
<li><p>“vasp_cmd” (str)</p></li>
<li><p>“symprec” (float)</p></li>
<li><p>“angle_tolerance” (float)</p></li>
<li><p>“xc” (str)</p></li>
<li><p>“kpt_density” (float)</p></li>
<li><p>“initial_kpt_density” (float)</p></li>
<li><p>“vise_opts” (dict):</p></li>
<li><p>“user_incar_setting” (dict)</p></li>
<li><p>“ldauu” (dict)</p></li>
<li><p>“ldaul” (dict)</p></li>
<li><p>“potcar_set”</p></li>
<li><p>“potcar_set_name” (str)</p></li>
<li><p>“relax_iter_num” (int)</p></li>
<li><p>“removed_files” (list)</p></li>
</ul>
<p>For vise_opts corresponds to the Options written in ViseInputSet class in vise.input_set/input_set.py</p>
<p>Same info is written at the top of the <code class="docutils literal notranslate"><span class="pre">main.py</span></code> file.
For example, one can write in <code class="docutils literal notranslate"><span class="pre">vise.yaml</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xc</span><span class="p">:</span> <span class="n">hse</span>
</pre></div>
</div>
<p>for XC functional.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial  pydefect</a><ul>
<li><a class="reference internal" href="#preparation-of-the-unit-cell">1. Preparation of the unit cell</a></li>
<li><a class="reference internal" href="#preparation-of-the-input-files-for-the-unit-cell-relaxation">2. Preparation of the input files for the unit cell relaxation.</a></li>
<li><a class="reference internal" href="#calculation-of-the-unit-cell-relaxation">3. Calculation of the unit cell relaxation.</a></li>
<li><a class="reference internal" href="#calculation-of-the-band-structure-and-the-density-of-states">4. Calculation of the band structure and the density of states</a></li>
<li><a class="reference internal" href="#calculation-of-the-dielectric-constant">5. Calculation of the dielectric constant</a></li>
<li><a class="reference internal" href="#setting-for-the-vise-yaml">Setting for the vise.yaml</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="change_log.html"
                        title="previous chapter"># Change log</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="change_log.html" title="# Change log"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">vise beta documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Yu Kumagai.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>